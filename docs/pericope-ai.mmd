graph TD

%% â”€â”€â”€ ENTRYPOINTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
A1["ðŸŒ pericopeai.com (Frontend + /api path)"]
A2["ðŸ” auth.pericopeai.com (Keycloak realm)"]

%% â”€â”€â”€ NGINX CONFIGURATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph S1["ðŸ§­ /etc/nginx/sites-available/pericopeai.conf (host)"]
  S1a["location / â†’ proxy_pass 127.0.0.1:13080 (FE container)"]
  S1b["location /api â†’ proxy_pass 127.0.0.1:18000 (API container)"]
end

A1 --> S1
A2 -->|OIDC authority| S1

%% â”€â”€â”€ FRONTEND (CONTAINER) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph S2["ðŸŽ¨ pericopeai-frontend container"]
  S2a["build from /root/workspace/AugustineFE"]
  S2b["nginx in-container on :80 â†’ mapped to host :13080"]
end

S1a --> S2a

%% â”€â”€â”€ BACKEND (CONTAINER) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph S3["âš™ï¸ pericopeai-api container"]
  S3a["main.py (FastAPI uvicorn) on :8080 â†’ host :18000"]
  S3b["routes/auth.py, routes/chat.py"]
  S3c[".env â†’ DB creds (HostGator), OIDC vars"]
end

S1b --> S3a
S3a -->|OIDC| A2

%% â”€â”€â”€ DATABASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph S4["ðŸ—„ï¸ HostGator MySQL (remote)"]
  S4a["DB: cwrihote_chatbook (per .env)"]
end

S3a -->|SQLAlchemy| S4

%% â”€â”€â”€ AUTH SERVER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph S5["ðŸ” Keycloak (two instances present)"]
  S5a["Host Java â†’ 8080"]
  S5b["Docker â†’ 8081 (auth-keycloak-1)"]
end

A2 --> S5a
S3a --> S5a

%% â”€â”€â”€ LOGICAL FLOW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
User["User Browser"] -->|visit pericopeai.com| A1
User -->|login redirect| A2
A1 -->|/api calls| S3a
S3a -->|persist| S4
S5a -->|tokens| S3a
%% Note: API served via path /api on pericopeai.com (api.* subdomain unused).
