graph TD

%% â”€â”€â”€ ENTRYPOINTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
A1["ðŸŒ pericopeai.com (Frontend + /api path)"]
A2["ðŸ” auth.pericopeai.com (Keycloak realm)"]

%% â”€â”€â”€ NGINX CONFIGURATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph S1["ðŸ§­ /etc/nginx/sites-available/pericopeai.conf"]
  S1a["location / â†’ React build"]
  S1b["location /api â†’ proxy_pass 127.0.0.1:8000"]
end

A1 --> S1
A2 -->|OIDC authority| S1

%% â”€â”€â”€ FRONTEND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph S2["ðŸŽ¨ /var/www/pericopeai/"]
  S2a["build/ â†’ compiled React app"]
  S2b["assets/ â†’ images, fonts, JS bundles"]
  S2c["config.json â†’ Keycloak + API endpoints"]
end

S1a --> S2a
S2a -->|calls /api| S1b

%% â”€â”€â”€ BACKEND (HOST PROCESS) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph S3["âš™ï¸ /var/www/pericopeai.com/AugustineService/"]
  S3a["main.py â†’ FastAPI uvicorn"]
  S3b["routes/auth.py â†’ token exchange"]
  S3c["routes/chat.py â†’ chat + RAG"]
  S3d[".env â†’ secrets, DB creds, OIDC vars"]
end

S1b --> S3a
S3b -->|OIDC| A2
S3a -->|reads env| S3d

%% â”€â”€â”€ DATABASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph S4["ðŸ—„ï¸ MariaDB localhost:3306"]
  S4a["users"]
  S4b["sessions"]
  S4c["messages"]
end

S3a -->|SQLAlchemy| S4

%% â”€â”€â”€ AUTH SERVER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph S5["ðŸ” Keycloak (two instances present)"]
  S5a["Host Java â†’ 8080 (active)"]
  S5b["Docker â†’ 8081 (duplicate)"]
end

A2 --> S5a
S3b --> S5a

%% â”€â”€â”€ LOGICAL FLOW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
User["User Browser"] -->|visit pericopeai.com| A1
User -->|login redirect| A2
A1 -->|/api calls| S3a
S3a -->|persist| S4
S5a -->|tokens| S3a
%% Note: API served via path /api on pericopeai.com (api.* subdomain unused).
