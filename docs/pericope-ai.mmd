graph TD

%% â”€â”€â”€ ENTRYPOINTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
A1["ðŸŒ pericopeai.com (Frontend + /api path)"]
A2["ðŸ” auth.pericopeai.com (Keycloak realm)"]

%% â”€â”€â”€ NGINX CONFIGURATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph S1["ðŸ§­ /etc/nginx/sites-available/pericopeai.conf (host)"]
  S1a["location / â†’ proxy_pass 127.0.0.1:13080 (FE container)"]
  S1b["location /api â†’ proxy_pass 127.0.0.1:18000 (API container)"]
end

A1 --> S1
A2 -->|OIDC authority| S1

%% â”€â”€â”€ FRONTEND (CONTAINER) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph S2["ðŸŽ¨ pericopeai-frontend container"]
  S2a["build from /root/workspace/AugustineFE"]
  S2b["nginx in-container on :80 â†’ mapped to host :13080"]
end

S1a --> S2a

%% â”€â”€â”€ BACKEND (CONTAINER) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph S3["âš™ï¸ pericopeai-api container"]
  S3a["main.py (FastAPI uvicorn) on :8080 â†’ host :18000"]
  S3b["routes/auth.py, routes/chat.py"]
  S3c[".env â†’ DB creds (local MySQL), OIDC vars"]
  S3d["CORPUS_API_URL â†’ http://augustine-corpus-1-0-0:8001"]
end

S1b --> S3a
S3a -->|OIDC| A2
S3a -->|corpus/search| S4a

%% â”€â”€â”€ CORPUS SERVICE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph S4["ðŸ“š Augustine Corpus (container)"]
  S4a["augustine-corpus-1-0-0 â†’ port 8001"]
  S4b["Indexes volume: corpus_indexes"]
end

%% â”€â”€â”€ DATABASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph S5["ðŸ—„ï¸ MySQL (container)"]
  S5a["mysql:8.0 â†’ port 3306 (host-mapped as ${MYSQL_HOST_PORT:-3307})"]
  S5b["Volume: mysql_data"]
end

S3a -->|SQLAlchemy| S5

%% â”€â”€â”€ AUTH SERVER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph S6["ðŸ” Keycloak (two instances present)"]
  S6a["Host Java â†’ 8080"]
  S6b["Docker â†’ 8081 (auth-keycloak-1)"]
end

A2 --> S6a
S3a --> S6a

%% â”€â”€â”€ LOGICAL FLOW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
User["User Browser"] -->|visit pericopeai.com| A1
User -->|login redirect| A2
A1 -->|/api calls| S3a
S3a -->|persist| S5
S6a -->|tokens| S3a
S3a -->|corpus calls| S4a
%% Note: API served via path /api on pericopeai.com (api.* subdomain unused).
