graph TD

%% â”€â”€â”€ ENTRYPOINTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
A1["ðŸŒ askmortgageauthority.com (WordPress â€“ Contabo, container)"]
A2["ðŸ¤– chat.askmortgageauthority.com (Chat API â€“ Contabo, FastAPI:9001)"]
A3["ðŸ“Š calculator.askmortgageauthority.com (Calculators â€“ Contabo, container)"]
A4["ðŸ“¨ crm.askmortgageauthority.com (CRM API â€“ HostGator Laravel)"]
A5["ðŸ” auth.askmortgageauthority.com (Keycloak â€“ missing DNS)"]

%% â”€â”€â”€ CONTABO STACK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph C1["ðŸ§­ Contabo VPS 89.117.151.145"]
  subgraph C1a["Nginx reverse proxy (80/443)"]
    C1a1["askmortgageauthority.com vhost â†’ WP container 18020"]
    C1a2["chat.askmortgageauthority.com vhost â†’ FastAPI 9001"]
    C1a3["auth.pericopeai.com vhost"]
  end
  subgraph C1b["Containers"]
    C1b1["ama-wordpress-nginx â†’ host 18020"]
    C1b2["ama-wordpress (php-fpm)"]
    C1b3["calculators-app â†’ host 18010"]
  end
  subgraph C1c["FastAPI Services (host processes)"]
    C1c1["/var/www/chat-api/app/main.py â†’ port 9001"]
  end
  subgraph C1d["Identity"]
    C1d1["Keycloak (host Java) â†’ 8080"]
    C1d2["Keycloak (Docker) â†’ 8081 (duplicate)"]
  end
  subgraph C1e["Database"]
    C1e1["MariaDB localhost:3306"]
    C1e2["AMA WordPress DB (local)"]
  end
end

A1 -->|proxied by| C1a1
A2 -->|should proxy| C1a2
A1 -->|served via| C1b1
A3 -->|proxied via| C1b3
A1 -->|uses DB| C1e2
C1c1 -->|auth| C1d1
C1c1 -->|DB?| C1e1

%% â”€â”€â”€ HOSTGATOR STACK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph H1["ðŸŒ HostGator 50.6.160.246"]
  H1b["/home/authority/crm_api â†’ Laravel CRM"]
  H1c["MySQL â†’ CRM data"]
end

A4 --> H1b
H1b --> H1c

%% â”€â”€â”€ FLOWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
User["User Browser"] -->|visit AMA| A1
User -->|open chat| A2
User -->|calculator| A3
A1 -->|forms to CRM| A4
A3 -->|submits results| A4
A2 -->|should hit FastAPI 9001| C1c1
C1a2 -->|currently overridden by| C1a1

%% â”€â”€â”€ NOTES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
%% - AMA WordPress lives on Contabo; DB is local MariaDB.
%% - Chat API runs on host (not Docker) at /var/www/chat-api/app on port 9001.
%% - Two Keycloak instances exist (host 8080, Docker 8081); choose one.
%% - Nginx has conflicting vhosts; chat routing is broken externally.
%% - HostGator still serves calculators + CRM + MySQL. WordPress no longer uses HostGator DB.
