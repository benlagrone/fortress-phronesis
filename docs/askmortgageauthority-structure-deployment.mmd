graph TD

U1["End User / Browser"]
U1 -->|HTTPS 443| P1

%% â”€â”€â”€ NGINX FRONT (CONTABO) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph P1["ðŸ§­ /etc/nginx/ (Contabo 89.117.151.145)"]
  P1a["sites-enabled/askmortgageauthority.com â†’ WP container 18020"]
  P1b["sites-enabled/chat.askmortgageauthority.com"]
  P1c["sites-enabled/pericopeai.com"]
  P1d["sites-enabled/auth.pericopeai.com.conf"]
end

%% â”€â”€â”€ WORDPRESS (CONTAINERS) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph F1["ðŸŽ¨ WordPress (Docker)"]
  F1a["ama-wordpress-nginx â†’ host 18020"]
  F1b["ama-wordpress (php-fpm)"]
end

P1 -->|proxy to 18020| F1

%% â”€â”€â”€ CHAT API (CONTABO) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph P2["ðŸ¤– Chat API /var/www/chat-api/app/"]
  P2a["main.py (FastAPI uvicorn)"]
  P2b["Port 9001 (host process, not Docker)"]
end

P1b -->|should proxy| P2a

%% â”€â”€â”€ AUTH (CONTABO) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph A1["ðŸ” Keycloak"]
  A1a["Host Java (8080)"]
  A1b["Docker container (8081) â€” duplicate"]
end

P1d --> A1a
P2a -->|OIDC| A1a

%% â”€â”€â”€ DATABASE (CONTABO) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph D1["ðŸ—„ï¸ MariaDB localhost:3306"]
  D1a["AMA WordPress DB (local)"]
  D1b["PericopeAI DB"]
end

F1b --> D1a
P2a -->|likely uses| D1

%% â”€â”€â”€ HOSTGATOR EXTERNALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph H1["ðŸŒ HostGator 50.6.160.246"]
  H1b["crm.askmortgageauthority.com (Laravel API)"]
  H1c["MySQL (CRM)"]
end

F1 -->|forms/redirects| H1b
H1b --> H1c

%% â”€â”€â”€ FLOW SUMMARY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
U1 -->|AMA site| F1
U1 -->|Chat| P1b
F1 -->|may call CRM| H1b
P2a -->|DB| D1
A1a -->|tokens| P2a

%% â”€â”€â”€ NOTES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
%% - WordPress runs in Docker (nginx 18020); chat API on host 9001.
%% - Chat vhost conflicts should be cleaned separately.
%% - Two Keycloaks exist (8080 host, 8081 Docker); pick one to keep.
%% - HostGator serves CRM only; calculators moved to Contabo container on 18010.
