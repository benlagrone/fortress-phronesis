graph TD

U1["End User / Browser"]
U1 -->|HTTPS 443| P1

%% â”€â”€â”€ NGINX FRONT (CONTABO) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph P1["ðŸ§­ /etc/nginx/ (Contabo 89.117.151.145)"]
  P1a["sites-enabled/askmortgageauthority.com (conflicts present)"]
  P1b["sites-enabled/chat.askmortgageauthority.com (overridden)"]
  P1c["sites-enabled/pericopeai.com"]
  P1d["sites-enabled/auth.pericopeai.com.conf"]
end

%% â”€â”€â”€ WORDPRESS (CONTABO) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph F1["ðŸŽ¨ WordPress /var/www/askmortgageauthority/"]
  F1a["Apache php-fpm on 8080"]
  F1b["wp-config.php â†’ DB_HOST=localhost"]
end

P1 -->|proxy to 8080| F1

%% â”€â”€â”€ CHAT API (CONTABO) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph P2["ðŸ¤– Chat API /var/www/chat-api/app/"]
  P2a["main.py (FastAPI uvicorn)"]
  P2b["Port 9001 (host process, not Docker)"]
end

P1b -->|should proxy| P2a

%% â”€â”€â”€ AUTH (CONTABO) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph A1["ðŸ” Keycloak"]
  A1a["Host Java (8080)"]
  A1b["Docker container (8081) â€” duplicate"]
end

P1d --> A1a
P2a -->|OIDC| A1a

%% â”€â”€â”€ DATABASE (CONTABO) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph D1["ðŸ—„ï¸ MariaDB localhost:3306"]
  D1a["AMA WordPress DB (local)"]
  D1b["PericopeAI DB"]
end

F1b --> D1a
P2a -->|likely uses| D1

%% â”€â”€â”€ HOSTGATOR EXTERNALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subgraph H1["ðŸŒ HostGator 50.6.160.246"]
  H1a["calculator.askmortgageauthority.com (static JS)"]
  H1b["crm.askmortgageauthority.com (Laravel API)"]
  H1c["MySQL (CRM + calculators)"]
end

U1 -->|calculator| H1a
F1 -->|forms/redirects| H1b
H1b --> H1c

%% â”€â”€â”€ FLOW SUMMARY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
U1 -->|AMA site| F1
U1 -->|Chat| P1b
P1a -->|conflict with| P1b
F1 -->|may call CRM| H1b
P2a -->|DB| D1
A1a -->|tokens| P2a

%% â”€â”€â”€ NOTES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
%% - WordPress and Chat API run on Contabo; Apache 8080, FastAPI 9001.
%% - Nginx vhost conflicts cause /chat to hit WordPress 404.
%% - Two Keycloaks exist (8080 host, 8081 Docker); pick one to keep.
%% - HostGator still serves calculators + CRM + MySQL; AMA WP no longer uses HostGator DB.
